<!doctype html>
<!--
  Course: DATA 300L 111 Spring 2020
  Author: Emily and Emma
-->
<html lang="en">

<head>
  <title>Broadway Shows</title>
  <meta charset="utf-8" />
  <link href="broadwayvis.css" rel="stylesheet" />
  <script src="https://d3js.org/d3.v5.min.js"></script>

  <script>
    window.onload = () => {
      const broadway2015 = [{
          "Show": "The Book of Mormon",
          "Average Gross Potential": 108.17
        },
        {
          "Show": "The Lion King",
          "Average Gross Potential": 98.10
        }, {
          "Show": "Aladdin",
          "Average Gross Potential": 97.27
        }, {
          "Show": "Wicked",
          "Average Gross Potential": 97.08
        }, {
          "Show": "Matilda",
          "Average Gross Potential": 71.75
        }, {
          "Show": "Kinky Boots",
          "Average Gross Potential": 68.04
        }, {
          "Show": "Les Miserables '14",
          "Average Gross Potential": 61.00
        }, {
          "Show": "The Phantom of the Opera",
          "Average Gross Potential": 59.29
        }
      ];


      const broadwayAvgGrossPotential = 59.29;

      const barSpacing = 10;
      const strokeWidth = 2;
      const w = 700;
      const h = 250;
      const barChart = d3.select("#bar-chart").append("svg").attr("width", w).attr("height", h);
      d3.select("#bar-chart").append("figcaption")
        .text("Average Gross Potential of each Broadway show over the course of the entire year.");

      //CREATING SCALES

      const grossPotential = broadway2015.map(d => d["Average Gross Potential"]);

      const wScale = d3.scaleLinear()
        //interval in which the data values may appear
        .domain([0, d3.max(grossPotential)])
        //interval in which the output values will be
        .range([0, .8 * w]) //do the *.8 so that the max bar fits on the chart

      const yScale = d3.scaleLinear()
        .domain([0, broadway2015.length])
        .range([0, h])


      //            const bars = barChart
      //                .selectAll("g")
      //                .data(broadway2015)
      //                .enter()
      //                .append("g")
      //                //move things around i.e text labels or make them bigger or smaller
      //                .attr("transform", (d, i) => "translate(0," + (yScale(i) + strokeWidth) + ")");
      //            
      const bars = barChart.selectAll("g.bar")
        .remove()
        .exit()
        .data(broadway2015)
        .enter()
        .append("g")
        .attr("class", "bar")
        .attr("transform", (d, i) => "translate(0," + (yScale(i) + strokeWidth) + ")")
        .on("click", toggleSelected)
        .on("dblclick", (d) => {
          if (Number.isInteger(d["Average Gross Potential"]))
            displayItems(barChart, data);
          else
            displayItems(barChart, data, d["Average Gross Potential"])
        });

      bars
        .append("rect")
        .attr("x", strokeWidth)
        .attr("width", d => wScale(d["Average Gross Potential"]))
        .attr("height", h / broadway2015.length - barSpacing)
        .style("fill", d => {
          const overUnder = d["Average Gross Potential"] - grossPotential;
          const saturation = Math.round(100 * 2 * overUnder / grossPotential);
          return "hsl(0," + saturation + "%,50%)";
        })
        .style("stroke-width", strokeWidth);

      const textGap = 2;

      bars
        .append("text")
        .text(d => d["Average Gross Potential"])
        .attr("x", d => wScale(d["Average Gross Potential"] + textGap))
        .attr("y", (h / broadway2015.length - barSpacing) / 1.8)
        .attr("alignment-baseline", "middle") //middle alignment relative to the y-coord
        .style("font-size", "11pt");


      bars
        .append("text")
        .text(d => d["Show"])
        .attr("x", "12pt") //instead of 2 * barSpacing, "12pt" gives spacing of size of capital letter 'M'
        .attr("y", (h / broadway2015.length - barSpacing) / 1.8)
        .attr("alignment-baseline", "middle") //middle alignment relative to the y-coord
        .style("fill", "black")
        .style("font-size", "10pt");

      //            const x_axis = d3.scaleLinear().domain([0, 600]);
      //
      //
      // barChart.append("g").attr("transform", "translate(0,250)").call(d3.axisBottom(x_axis));

      function toggleSelected() {
        if (d3.select(this).attr("class") === "bar")
          d3.select(this).attr("class", "bar selected");
        else
          d3.select(this).attr("class", "bar");
      }
    }

  </script>
</head>

<body>
  <h1>Top Grossing Broadway Shows 2015</h1>
  <p> The charts below display data regarding the top grossing Broadway shows that aired every week during 2015. The line chart will show the monthly average profit of each Broadway show and the bar chart will show how well they met their potential profit.</p>
  <section>
    <h2>Line Graph
    </h2>
    <figure id="line-chart"></figure>
  </section>
  <section>
    <h2>Gross Potential of Broadway Shows</h2>
    <p>The Gross Potential is the maximum amount a show can possibly earn based on calculations involving ticket prices, seating capacity, and the number of performances. This number is expressed here as a percentage of what could have been achieved (Gross Gross / Gross Potential).</p>
    <p>Hover over any bar to see the Broadway show name and its gross potential percentage. Click to select and highlight for easier comparison.</p>
    <figure id="bar-chart"></figure>
    <p2>We can notice in the chart above that although these shows were the most profitable in 2015, they could have achieved higher gross values.</p2>
  </section>

</body>

</html>
